<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ocnice_prep: ocnice_prep</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ocnice_prep
   &#160;<span id="projectnumber">1.13.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ocnice_prep </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md1"></a>
Introduction</h1>
<p>The ocnice_prep program will downscale a MOM6 or CICE6 1/4deg tripole restart file to a desired lower resolution tripole warm-start file using ESMF regridding.</p>
<p>This document is part of the <a href="../index.html">UFS_UTILS documentation</a>.</p>
<p>The ocnice_prep program is part of the <a href="https://github.com/ufs-community/UFS_UTILS">UFS_UTILS</a> project.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Description of MOM6 and CICE6 restarts</h2>
<p>A warmstart file can be created from an existing restart file (at higher resolution) by using ESMF Regridding to map fields to a destination grid. For MOM6, the procedure produces a warm-start file (composed of T,S,U,V and Interface Height), where the utility creates the interface heights (<code>eta</code>) using the sea surface height (<code>sfc</code>) and the interface thickness (<code>h</code>) in the MOM6 restart. A full restart file is not generated because MOM6 has resolution dependent parameterizations, so that restart files for different resolutions might contain different fields. For CICE6, a file consisting of all the restart fields is produced. While in the form of a "true" restart, it is also more appropriately considered to be a warm-start file.</p>
<p>Both MOM6 and CICE6 restarts contain fields which include a dimension in addition to the 2 spatial dimensions. For MOM6, this is the vertical dimension (ocean depth) while for CICE6 it is the number of ice thickness categories. In this utility, both are referred to as the <code>nlevs</code> dimension. MOM6 restarts also contain metadata (e.g. <code>units</code>) while CICE6 restarts contain no metadata. Metadata, if any, is written to the new warm start files.</p>
<p>Fields in the restart files for both MOM6 and CICE6 are defined at locations on the Arakawa C-grid. Similar to the <code>cpld_gridgen</code> utility, these are referred to here as the <code>Ct</code>, <code>Cu</code>, <code>Cv</code> and <code>Bu</code> locations. Vectors in MOM6 are natively located at the north and east faces (<code>Cv</code> and <code>Cu</code>) while CICE vectors are located at <code>Bu</code> locations. <b>NOTE:</b> The CICE-C grid is not currently supported.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Pre-generation of a single MOM6 restart file</h2>
<p>Because the required fields for MOM6 are located in two separate restart files, a single file containing all the necessary fields must be generated for the <code>ocean</code> case. This is done using NetCDF operators (NCO) with the following commands, assuming that the two required MOM6 restart files are available locally and are named <code>MOM.res.nc</code> and <code>MOM.res_1.nc</code>.</p>
<div class="fragment"><div class="line">ncks -v Temp,Salt,h,u MOM.res.nc ocean.nc</div><div class="line">ncks -v v,sfc -A MOM.res_1.nc ocean.nc</div></div><!-- fragment --><h2><a class="anchor" id="autotoc_md4"></a>
Utilizing a warm-start file for MOM6 or CICE6</h2>
<p>For MOM6, the following MOM_input settings can then be used with the warm-start file (e.g. <code>ocean.mx100.nc</code>):</p>
<div class="fragment"><div class="line">! === module MOM_state_initialization ===</div><div class="line">INIT_LAYERS_FROM_Z_FILE = False  !   [Boolean] default = False</div><div class="line">                                ! If true, initialize the layer thicknesses, temperatures, and salinities from a</div><div class="line">                                ! Z-space file on a latitude-longitude grid.</div><div class="line">! WARMSTARTS</div><div class="line">THICKNESS_CONFIG = &quot;file&quot;       ! default = &quot;uniform&quot;</div><div class="line">                                ! A string that determines how the initial layer thicknesses are specified for a</div><div class="line">                                ! new run:</div><div class="line">                                !     file - read interface heights from the file specified</div><div class="line">                                !       by (THICKNESS_FILE).</div><div class="line">THICKNESS_FILE = &quot;ocean.mx100.nc&quot; !</div><div class="line">                                ! The name of the thickness file.</div><div class="line">ADJUST_THICKNESS = True         !   [Boolean] default = False</div><div class="line">                                ! If true, all mass below the bottom removed if the topography is shallower than</div><div class="line">                                ! the thickness input file would indicate.</div><div class="line">INTERFACE_IC_VAR = &quot;eta&quot;        ! default = &quot;eta&quot;</div><div class="line">                                ! The variable name for initial conditions for interface heights relative to</div><div class="line">                                ! mean sea level, positive upward unless otherwise rescaled.</div><div class="line">TS_CONFIG = &quot;file&quot;              !</div><div class="line">                                ! A string that determines how the initial temperatures and salinities are</div><div class="line">                                ! specified for a new run:</div><div class="line">                                !     file - read velocities from the file specified</div><div class="line">TS_FILE = &quot;ocean.mx100.nc&quot;      !</div><div class="line">                                ! The initial condition file for temperature.</div><div class="line">TEMP_IC_VAR = &quot;Temp&quot;            ! default = &quot;PTEMP&quot;</div><div class="line">                                ! The initial condition variable for potential temperature.</div><div class="line">SALT_IC_VAR = &quot;Salt&quot;            ! default = &quot;SALT&quot;</div><div class="line">                                ! The initial condition variable for salinity.</div><div class="line">SALT_FILE = &quot;ocean.mx100.nc&quot;    ! default = &quot;ocean.mx100.nc&quot;</div><div class="line">                                ! The initial condition file for salinity.</div><div class="line">VELOCITY_CONFIG = &quot;file&quot;        ! default = &quot;zero&quot;</div><div class="line">                                ! A string that determines how the initial velocities are specified for a new</div><div class="line">                                ! run:</div><div class="line">                                !     file - read velocities from the file specified</div><div class="line">                                !       by (VELOCITY_FILE).</div><div class="line">VELOCITY_FILE = &quot;ocean.mx100.nc&quot; !</div><div class="line">                                ! The name of the velocity initial condition file.</div><div class="line">U_IC_VAR = &quot;u&quot;                  ! default = &quot;u&quot;</div><div class="line">                                ! The initial condition variable for zonal velocity in VELOCITY_FILE.</div><div class="line">V_IC_VAR = &quot;v&quot;                  ! default = &quot;v&quot;</div></div><!-- fragment --><p>For CICE6, the warm-start file (e.g. <code>ice.mx100.nc</code>) can be used directly in the <code>ice_in</code> namelist:</p>
<div class="fragment"><div class="line">runtype             = &#39;initial&#39;</div><div class="line">runid               = &#39;unknown&#39;</div><div class="line">ice_ic              = &#39;ice.mx100.nc&#39;</div></div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
Remapping procedure</h2>
<p>Remapping is done using an ESMF remapping via a RouteHandle, where the both the source and destination mask values are <code>0</code>. This ensures that only water points are mapped between the grids. Extrapolation is used to map destination points which are unmapped because the source grid was not a water point. Since for the ocean, the required mapping varies with depth, the utility makes use of dynamic masking if required. This allows the same RouteHandle to be used for all depths, with masking at each depth done <em>on the fly</em>. This is not required for CICE6, since in that case all <code>nlevs</code> have the same land mask value.</p>
<p>Mapping for MOM6 is done using <code>bilinear</code> mapping, whereas for CICE6 it is done using <code>nearest-source-to-destination</code> mapping. For CICE6, this ensures that the thermodynamic fields in the CICE6 restart, which are for each vertical layer (typically 7) and each thickness category (typically 5), are consistent when mapped.</p>
<p>The general procedure, for either MOM6 or CICE6 is as follows:</p>
<ol type="1">
<li>Fields are retrieved from the source file and placed on the <code>Ct</code> grid location. For vector fields, the vectors are rotated from their orientation along model dimensions (IJ) to eastward-northward (EN) directions.</li>
<li>Fields are packed into arrays by mapping type (bilinear or conservative) and dimensionality.</li>
<li>Fields are remapped using ESMF. This remapping may use dynamic Masking.</li>
<li>Vector fields are re-rotated back to model index direction (EN-&gt;IJ) and remapped back to their native stagger locations.</li>
<li>Fields are written into a warm-start file.</li>
</ol>
<h2><a class="anchor" id="autotoc_md6"></a>
Note on rotation angles</h2>
<p>The rotation angle retrieved from the master grid file is <code>anglet</code>, which is defined in the same sense as used MOM6. This is the opposite sense to the use in CICE6. The rotation formulas implement rotation in the same sense as MOM6. Since <code>-sin(-angle) == sin(angle)</code>, no sign change of the angle is required for rotation of the CICE6 vectors. This is in contrast to the <code>ocnpost</code> routine, where the angle used is retrieved from CICE6's own history file and requires a sign change prior to use in the rotation formulas.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Required files</h2>
<p>The following files are required.</p>
<ul>
<li>The ESMF mesh file for the source and destination grids. These are available as products of the <code>cpld_gridgen</code> utility.</li>
<li>The remapping weights for mapping fields to and from <code>Ct</code> grid locations on both the souce and destination grids. These are also available as products of the <code>cpld_gridgen</code> utility.</li>
<li>A text file (csv) listing the fields to be remapped for either the ocean or ice restart file.</li>
<li>A namelist file defining the type of regridding desired (<code>ocean</code> or <code>ice</code>) and the locations of the needed weights. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>

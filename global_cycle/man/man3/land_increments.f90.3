.TH "/scratch1/NCEPDEV/da/George.Gayno/ufs_utils.git/UFS_UTILS.upstream/sorc/global_cycle.fd/land_increments.f90" 3 "Thu Jun 20 2024" "Version 1.13.0" "global_cycle" \" -*- nroff -*-
.ad l
.nh
.SH NAME
/scratch1/NCEPDEV/da/George.Gayno/ufs_utils.git/UFS_UTILS.upstream/sorc/global_cycle.fd/land_increments.f90 \- Routines for applyng land DA increments\&.  

.SH SYNOPSIS
.br
.PP
.SS "Functions/Subroutines"

.in +1c
.ti -1c
.RI "subroutine, public \fBland_increments::add_increment_soil\fP (lsoil_incr, stcinc, slcinc, stc_state, smc_state, slc_state, stc_updated, slc_updated, soilsnow_tile, soilsnow_fg_tile, lensfc, lsoil, lsm, myrank)"
.br
.RI "Read in soil state increments (on the cubed-sphere grid),and add to the soil states\&. "
.ti -1c
.RI "subroutine, public \fBland_increments::add_jedi_increment_snow\fP (snd_inc, mask, lensfc, snd)"
.br
.RI "Add snow depth increment to model snow depth state, and limit output to be non-negative\&. "
.ti -1c
.RI "subroutine, public \fBland_increments::apply_land_da_adjustments_snd\fP (lsm, lensfc, mask, swe_bck, snd_bck, snd_anl, swe_adj)"
.br
.RI "Make adjustments to dependent variables after applying land increments\&. "
.ti -1c
.RI "subroutine, public \fBland_increments::apply_land_da_adjustments_soil\fP (lsoil_incr, lsm, isot, ivegsrc, lensfc, lsoil, rsoiltype, mask, stc_bck, stc_adj, smc_adj, slc_adj, stc_updated, slc_updated, zsoil)"
.br
.RI "Make adjustments to dependent variables after applying land increments\&. "
.ti -1c
.RI "subroutine, public \fBland_increments::calculate_landinc_mask\fP (swe, vtype, stype, lensfc, veg_type_landice, mask)"
.br
.RI "Calculate soil mask for land on model grid\&. "
.ti -1c
.RI "subroutine, public \fBland_increments::gaussian_to_fv3_interp\fP (lsoil_incr, rla, rlo, stcinc, slcinc, soilsnow_tile, lensfc, lsoil, idim, jdim, lsm, myrank)"
.br
.RI "Read in gsi file with soil state increments (on the gaussian grid), interpolate increments to the cubed-sphere tile Adapted from adjust_nsst\&. "
.in -1c
.SS "Variables"

.in +1c
.ti -1c
.RI "integer, parameter, public \fBland_increments::lsm_noah\fP =1"
.br
.RI "flag for NOAH land surface model "
.ti -1c
.RI "integer, parameter, public \fBland_increments::lsm_noahmp\fP =2"
.br
.RI "flag for NOAHMP land surface model copied from GFS_typedefs\&.F90 "
.ti -1c
.RI "real, parameter \fBland_increments::tfreez\fP =273\&.16"
.br
.RI "con_t0c in physcons "
.in -1c
.SH "Detailed Description"
.PP 
Routines for applyng land DA increments\&. 


.PP
\fBAuthor:\fP
.RS 4
Clara Draper ESRL/PSL 
.RE
.PP

.PP
Definition in file \fBland_increments\&.f90\fP\&.
.SH "Function/Subroutine Documentation"
.PP 
.SS "subroutine, public land_increments::add_increment_soil (integer, intent(in) lsoil_incr, real, dimension(lensfc,lsoil) stcinc, real, dimension(lensfc,lsoil) slcinc, real, dimension(lensfc, lsoil), intent(inout) stc_state, real, dimension(lensfc, lsoil), intent(inout) smc_state, real, dimension(lensfc, lsoil), intent(inout) slc_state, integer, dimension(lensfc), intent(out) stc_updated, integer, dimension(lensfc), intent(out) slc_updated, integer, dimension(lensfc), intent(in) soilsnow_tile, integer, dimension(lensfc), intent(in) soilsnow_fg_tile, integer, intent(in) lensfc, integer, intent(in) lsoil, integer, intent(in) lsm, integer, intent(in) myrank)"

.PP
Read in soil state increments (on the cubed-sphere grid),and add to the soil states\&. Adapted from original add_gsi_increment_soil routine\&.
.PP
\fBParameters:\fP
.RS 4
\fISLCINC\fP Liquid soil moisture increments on the cubed-sphere tile 
.br
\fISTCINC\fP Soil temperature increments on the cubed-sphere tile 
.br
\fISTC_STATE\fP Soil temperature state vector 
.br
\fISMC_STATE\fP Soil moisture (liquid plus solid) state vector 
.br
\fISLC_STATE\fP Liquid soil moisture state vector 
.br
\fIstc_updated\fP Integer to record whether STC in each grid cell was updated 
.br
\fIslc_updated\fP Integer to record whether SMC in each grid cell was updated 
.br
\fISOILSNOW_TILE\fP Land mask for increments on the cubed-sphere tile 
.br
\fISOILSNOW_FG_TILE\fP First guess land mask for increments on the cubed-sphere tile 
.br
\fILENSFC\fP Number of land points on a tile 
.br
\fILSOIL\fP Number of soil layers 
.br
\fILSOIL_INCR\fP Number of soil layers (from top) to apply soil increments to 
.br
\fIlsm\fP Integer flag indicating which land model is used 
.br
\fIMYRANK\fP MPI rank number
.RE
.PP
\fBAuthor:\fP
.RS 4
Yuan Xue\&. 11/2023 
.RE
.PP

.PP
Definition at line 297 of file land_increments\&.f90\&.
.SS "subroutine, public land_increments::add_jedi_increment_snow (real, dimension(lensfc), intent(in) snd_inc, integer, dimension(lensfc), intent(in) mask, integer, intent(in) lensfc, real, dimension(lensfc), intent(inout) snd)"

.PP
Add snow depth increment to model snow depth state, and limit output to be non-negative\&. JEDI increments are calculated globally, so must be screened to land-only locations here\&.
.PP
\fBParameters:\fP
.RS 4
\fIlensfc\fP Number of land points on this tile 
.br
\fIsnd_inc\fP Soil depth increments 
.br
\fImask\fP Land mask for increments 
.br
\fIsnd\fP Soil depth background (in), and analysis (out)
.RE
.PP
\fBAuthor:\fP
.RS 4
Clara Draper\&. 
.RE
.PP
\fBDate:\fP
.RS 4
August 2021 
.RE
.PP

.PP
Definition at line 445 of file land_increments\&.f90\&.
.SS "subroutine, public land_increments::apply_land_da_adjustments_snd (integer, intent(in) lsm, integer, intent(in) lensfc, integer, dimension(lensfc), intent(in) mask, real, dimension(lensfc), intent(in) swe_bck, real, dimension(lensfc), intent(in) snd_bck, real, dimension(lensfc), intent(in) snd_anl, real, dimension(lensfc), intent(inout) swe_adj)"

.PP
Make adjustments to dependent variables after applying land increments\&. These adjustments are model-dependent, and are currently only coded for Noah LSM\&. Here: adjust SWE to be consistent with updated SND, using snow density from the forecast\&. 
.PP
\fBParameters:\fP
.RS 4
\fIlsm\fP Integer code for the LSM 
.br
\fIlensfc\fP Number of land points for this tile 
.br
\fImask\fP Land mask for increments 
.br
\fIswe_bck\fP Background SWE 
.br
\fIsnd_bck\fP Background snow depth 
.br
\fIsnd_anl\fP Analysis snow depth 
.br
\fIswe_adj\fP SWE to be adjusted 
.RE
.PP
\fBAuthor:\fP
.RS 4
Clara Draper 
.RE
.PP
\fBDate:\fP
.RS 4
August 2021 
.RE
.PP

.PP
Definition at line 707 of file land_increments\&.f90\&.
.SS "subroutine, public land_increments::apply_land_da_adjustments_soil (integer, intent(in) lsoil_incr, integer, intent(in) lsm, integer, intent(in) isot, integer, intent(in) ivegsrc, integer, intent(in) lensfc, integer, intent(in) lsoil, real, dimension(lensfc), intent(in) rsoiltype, integer, dimension(lensfc), intent(in) mask, real, dimension(lensfc, lsoil), intent(in) stc_bck, real, dimension(lensfc, lsoil), intent(inout) stc_adj, real, dimension(lensfc,lsoil), intent(inout) smc_adj, real, dimension(lensfc,lsoil), intent(inout) slc_adj, integer, dimension(lensfc), intent(in) stc_updated, integer, dimension(lensfc), intent(in) slc_updated, real(kind=4), dimension(lsoil), intent(in) zsoil)"

.PP
Make adjustments to dependent variables after applying land increments\&. These adjustments are model-dependent, and are currently only coded if full for Noah LSM\&. For Noah LSM, copy relevent code blocks from model code (same as has been done in sfc_sub)\&. For Noah-MP, the adjustment scheme shown below as of 11/09/2023: Case 1: frozen ==> frozen, recalculate slc following opt_frz=1, smc remains Case 2: unfrozen ==> frozen, recalculate slc following opt_frz=1, smc remains Case 3: frozen ==> unfrozen, melt all soil ice (if any) Case 4: unfrozen ==> unfrozen along with other cases, (e\&.g\&., soil temp=tfrz),do nothing Note: For Case 3, Yuan Xue thoroughly evaluated a total of four options and current option is found to be the best as of 11/09/2023 
.PP
\fBParameters:\fP
.RS 4
\fIlsm\fP Integer code for the LSM 
.br
\fIisot\fP Integer code for the soil type data set 
.br
\fIivegsrc\fP Integer code for the vegetation type data set 
.br
\fIlensfc\fP Number of land points for this tile 
.br
\fIlsoil\fP Number of soil layers 
.br
\fIlsoil_incr\fP Number of soil layers (from top) to apply soil increments to 
.br
\fIrsoiltype\fP Array of input soil types 
.br
\fImask\fP Mask indicating surface type 
.br
\fIstc_bck\fP Background soil temperature states 
.br
\fIstc_adj\fP Analysis soil temperature states 
.br
\fIsmc_adj\fP Analysis soil moisture states 
.br
\fIslc_adj\fP Analysis liquid soil moisture states 
.br
\fIstc_updated\fP Integer to record whether STC in each grid cell was updated 
.br
\fIslc_updated\fP Integer to record whether SLC in each grid cell was updated 
.br
\fIzsoil\fP Depth of bottom of each soil layer 
.RE
.PP
\fBAuthor:\fP
.RS 4
Clara Draper 
.RE
.PP
\fBDate:\fP
.RS 4
April 2021 
.RE
.PP

.PP
Definition at line 536 of file land_increments\&.f90\&.
.SS "subroutine, public land_increments::calculate_landinc_mask (real, dimension(lensfc), intent(in) swe, real, dimension(lensfc), intent(in) vtype, real, dimension(lensfc), intent(in) stype, integer, intent(in) lensfc, integer, intent(in) veg_type_landice, integer, dimension(lensfc), intent(out) mask)"

.PP
Calculate soil mask for land on model grid\&. Output is 1 - soil, 2 - snow-covered, 0 - land ice, -1 not land\&.
.PP
\fBParameters:\fP
.RS 4
\fIlensfc\fP Number of land points for this tile 
.br
\fIveg_type_landice\fP Value of vegetion class that indicates land-ice 
.br
\fIstype\fP Soil type 
.br
\fIswe\fP Model snow water equivalent 
.br
\fIvtype\fP Model vegetation type 
.br
\fImask\fP Land mask for increments 
.RE
.PP
\fBAuthor:\fP
.RS 4
Clara Draper 
.RE
.PP
\fBDate:\fP
.RS 4
March 2021 
.RE
.PP
\fBAuthor:\fP
.RS 4
Yuan Xue: introduce stype to make the mask calculation more generic 
.RE
.PP

.PP
Definition at line 476 of file land_increments\&.f90\&.
.SS "subroutine, public land_increments::gaussian_to_fv3_interp (integer, intent(in) lsoil_incr, real, dimension(lensfc), intent(inout) rla, real, dimension(lensfc), intent(inout) rlo, real, dimension(lensfc,lsoil), intent(out) stcinc, real, dimension(lensfc,lsoil), intent(out) slcinc, integer, dimension(lensfc), intent(in) soilsnow_tile, integer, intent(in) lensfc, integer, intent(in) lsoil, integer, intent(in) idim, integer, intent(in) jdim, integer, intent(in) lsm, integer, intent(in) myrank)"

.PP
Read in gsi file with soil state increments (on the gaussian grid), interpolate increments to the cubed-sphere tile Adapted from adjust_nsst\&. 
.PP
\fBParameters:\fP
.RS 4
\fIRLA\fP Latitude on the cubed-sphere tile 
.br
\fIRLO\fP Longitude on the cubed-sphere tile 
.br
\fISOILSNOW_TILE\fP Land mask for increments on the cubed-sphere tile 
.br
\fILENSFC\fP Number of land points on a tile 
.br
\fILSOIL\fP Number of soil layers 
.br
\fILSOIL_INCR\fP Number of soil layers (from top) to apply soil increments to 
.br
\fIIDIM\fP 'I' dimension of a tile 
.br
\fIJDIM\fP 'J' dimension of a tile 
.br
\fIlsm\fP Integer flag indicating which land model is used (1-Noah, 2-Noah-MP) 
.br
\fIMYRANK\fP MPI rank number 
.br
\fIstcinc\fP Soil temperature increments on the cubed-sphere tile 
.br
\fIslcinc\fP Liquid soil moisture increments on the cubed-sphere tile
.RE
.PP
\fBAuthor:\fP
.RS 4
Clara Draper\&. 
.RE
.PP
\fBDate:\fP
.RS 4
March 2021 
.RE
.PP
\fBAuthor:\fP
.RS 4
Yuan Xue\&. 
.RE
.PP
\fBDate:\fP
.RS 4
Mar 2024 
.RE
.PP

.PP
Definition at line 48 of file land_increments\&.f90\&.
.PP
References read_write_data::idim_gaus, read_write_data::jdim_gaus, utils::remap_coef(), read_write_data::slc_inc_gaus, read_write_data::soilsnow_gaus, and read_write_data::stc_inc_gaus\&.
.SH "Variable Documentation"
.PP 
.SS "integer, parameter, public land_increments::lsm_noah =1"

.PP
flag for NOAH land surface model 
.PP
Definition at line 17 of file land_increments\&.f90\&.
.SS "integer, parameter, public land_increments::lsm_noahmp =2"

.PP
flag for NOAHMP land surface model copied from GFS_typedefs\&.F90 
.PP
Definition at line 18 of file land_increments\&.f90\&.
.SS "real, parameter land_increments::tfreez =273\&.16\fC [private]\fP"

.PP
con_t0c in physcons 
.PP
Definition at line 23 of file land_increments\&.f90\&.
.SH "Author"
.PP 
Generated automatically by Doxygen for global_cycle from the source code\&.

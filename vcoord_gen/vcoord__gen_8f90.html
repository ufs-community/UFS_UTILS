<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>vcoord_gen: /scratch1/NCEPDEV/da/George.Gayno/ufs_utils.git/UFS_UTILS.upstream/sorc/vcoord_gen.fd/vcoord_gen.f90 File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">vcoord_gen
   &#160;<span id="projectnumber">1.13.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('vcoord__gen_8f90.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">vcoord_gen.f90 File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Generates hybrid coordinate interface profiles.  
<a href="#details">More...</a></p>

<p><a href="vcoord__gen_8f90_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a94f642db6845ae6ffaeae766b4c3e19f"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcoord__gen_8f90.html#a94f642db6845ae6ffaeae766b4c3e19f">vcoord_gen</a> (levs, lupp, pbot, psig, ppre, pupp, ptop, dpbot, dpsig, dppre, dpupp, dptop, pmin, ak, bk)</td></tr>
<tr class="memdesc:a94f642db6845ae6ffaeae766b4c3e19f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subprogram generates hybrid coordinate interface profiles from a few given parameters.  <a href="#a94f642db6845ae6ffaeae766b4c3e19f">More...</a><br /></td></tr>
<tr class="separator:a94f642db6845ae6ffaeae766b4c3e19f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Generates hybrid coordinate interface profiles. </p>
<dl class="section author"><dt>Author</dt><dd>Mark Iredell </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2008-08-01 </dd></dl>

<p class="definition">Definition in file <a class="el" href="vcoord__gen_8f90_source.html">vcoord_gen.f90</a>.</p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a94f642db6845ae6ffaeae766b4c3e19f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94f642db6845ae6ffaeae766b4c3e19f">&#9670;&nbsp;</a></span>vcoord_gen()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine vcoord_gen </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>levs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>lupp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>pbot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>psig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>ppre</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>pupp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>ptop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dpbot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dpsig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dppre</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dpupp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dptop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>pmin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(0:levs), intent(out)&#160;</td>
          <td class="paramname"><em>ak</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(0:levs), intent(out)&#160;</td>
          <td class="paramname"><em>bk</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subprogram generates hybrid coordinate interface profiles from a few given parameters. </p>
<p>The hybrid coordinate is intended to start out at the bottom in pure sigma and end up at the top in pure pressure, with a smooth transition in between. The pressure thickness is close to quadratic in pressure, with maximum thicknesses in the middle of the domain. The coordinate pressure will have continuous second derivatives in level.</p>
<p>The hybrid coordinate is returned in terms of vectors AK and BK, where the interface pressure is defined as A+B*ps where ps is surface pressure Thus A=0 in regions of pure sigma and B=0 in regions of pure sigma. At the bottom, A(0)=0 and B(0)=1 so that surface pressure is the bottom boundary condition, while at the top, A(levs)=ptop and B(levs)=0 so that the constant top pressure (which can be zero) is the top boundary condition.</p>
<p>The procedure for the calculation is described in the remarks section below.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">levs</td><td>integer number of levels </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lupp</td><td>integer number of levels below pupp </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pbot</td><td>real nominal surface pressure (Pa) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">psig</td><td>real nominal pressure where coordinate changes from pure sigma (Pa) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppre</td><td>real nominal pressure where coordinate changes to pure pressure (Pa) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pupp</td><td>real nominal pressure where coordinate changes to upper atmospheric profile (Pa) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ptop</td><td>real pressure at top (Pa) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dpbot</td><td>real coordinate thickness at bottom (Pa) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dpsig</td><td>real thickness of zone within which coordinate changes to pure sigma (Pa) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dppre</td><td>real thickness of zone within which coordinate changes to pure pressure (Pa) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dpupp</td><td>real coordinate thickness at pupp (Pa) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dptop</td><td>real coordinate thickness at top (Pa) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pmin</td><td>real minimum surface pressure (Pa) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ak</td><td>real(0:levs) a coordinate values, bottom to top (Pa) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">bk</td><td>real(0:levs) b coordinate values, bottom to top ()</td></tr>
  </table>
  </dd>
</dl>
<p>Subprograms called:</p><ul>
<li>ludcmp lower and upper triangular decomposition</li>
<li>lubksb lower and upper triangular back substitution</li>
</ul>
<pre>
   Example: Create the operational GFS 64-level hybrid coordinate.
     real(8) pmin,ak(0:64),bk(0:64)
     call vcoord_gen(64,64,100000.,99400.,7000.,0.,0.,500.,1200.,18000.,60.,60.,&amp;
                  pmin,ak,bk)
     print '(2i6)',2,64
     print '(f12.3,f12.8)',(ak(k),bk(k),k=0,64)
     end</pre><pre>   Graphical description of parameters and zones:
     ptop  ---  -----  ----------------------
           ...  dptop
           ---         zone U (upper atmos)
           ...
     pupp  ---  -----  ----------------------
           ...  dpupp
           ---  -----
           ...         zone P (pure pressure)
           ---
           ...
     ppre  ---  -----  ----------------------
           ...
           ---  dppre  zone T1 (transition 1)
           ...
           ---  -----  ----------------------
           ...
           ---
           ...         zone T2 (transition 2)
           ---
           ...
           ---  -----  ----------------------
           ...
           ---  dpsig  zone T3 (transition 3)
           ...
     psig  ---  -----  ----------------------
           ...
           ---  -----  zone S (pure sigma)
           ...  dpbot
     pbot  ---  -----  ----------------------
 </pre><p>Detailed procedure description: 1 STEP 1. The pressure profile is computed with respect to the given reference surface pressure pbot. For this surface pressure, the 'sigma' thicknesses dsig are assumed to be proportional to a quadratic polynomial in sigma sig with zero intercepts sig1 and sig2 somewhere below and above the model domain, respectively. That is, dsig ~ (sig2-sig)*(sig-sig1)*dk Integrating this differential equation gives sig = (sig1*exp(c1*k+c2)+sig2)/(exp(c1*k+c2)+1) The required boundary conditions sig(0)=1 and sig(levs)=0 fix the proportionality and integration constants c1 and c2. The two crossing parameters (sig1 and sig2) are determined by two input sigma thickness conditions dsig/dk at the bottom and top which are respectively given as dpbot/(pbot-pupp) and dpupp/(pbot-pupp). The crossing parameters are computed using Newton-Raphson iteration. This procedure fixes the pressure profile for surface pressure pbot. 2 STEP 2. The pressure profile is computed with respect to a minimum surface pressure. This minimum surface pressure pmin is yet to be determined. Divide the profile into zones: zone U (pure pressure) from pupp to ptop zone P (pure pressure) from pupp to ppre zone T1 (transition 1) from ppre to ppre+dppre zone T2 (transition 2) from ppre+dppre to psig-dpsig zone T3 (transition 3) from psig-dpsig to psig zone S (pure "sigma") from psig to pmin (here sigma=p/ps so that d(ln(p))/dk is horizontally uniform) The pressure profile in the pure pressure zone P is set from step 1. The pressure thicknesses in zone T1 is set to be quadratic in level k. The pressure thicknesses in zone T2 is set to be linear in level k. The pressure thicknesses in zone T3 is set to be quadratic in level k. The pressure profile in the pure sigma zone S is also set from step 1. Thus there are nine unknowns: the 3 polynomial coefficients in zone T1 the 2 polynomial coefficients in zone T2 the 3 polynomial coefficients in zone T3 and the 1 minimum surface pressure. The nine conditions to determine these unknowns are: the thickness and its derivative match at zone P and T1 boundary the thickness and its derivative match at zone T1 and T2 boundary the thickness and its derivative match at zone T2 and T3 boundary the thickness and its derivative match at zone T3 and S boundary the sum of the thicknesses of zones T1, T2, T3, and S is pmin-ppre The unknowns are computed using standard linear decomposition. This procedure fixes the pressure profile for surface pressure pmin. 3 STEP 3. (Step 3 skipped if lupp=levs, in which case pupp=ptop and dpupp=dptop.) The pressure in zone U is assumed to be the exponential of a cubic polynomial in level k. The function must match the pressure at pupp, as well as the thickness and its derivative there, and the pressure at ptop+dptop at the second to top level. The latter 3 conditions are determined by using standard linear decomposition. 4 STEP 4. For an arbitrary surface pressure, the pressure profile is an linear combination of the pressure profiles for surface pressures pbot and pmin </p><pre>
     p(psfc)=p(pbot)*(psfc-pmin)/(pbot-pmin)+p(pmin)*(pbot-psfc)/(pbot-pmin)
 </pre><p> from which the hybrid coordinate profiles ak and bk are found such that </p><pre>
     p(psfc)=ak+bk*psfc
 </pre> <dl class="section author"><dt>Author</dt><dd>Mark Iredell </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2008-08-01 </dd></dl>

<p class="definition">Definition at line <a class="el" href="vcoord__gen_8f90_source.html#l00153">153</a> of file <a class="el" href="vcoord__gen_8f90_source.html">vcoord_gen.f90</a>.</p>

<p class="reference">References <a class="el" href="matrix__utils_8f90_source.html#l00101">lubksb()</a>, and <a class="el" href="matrix__utils_8f90_source.html#l00021">ludcmp()</a>.</p>

<p class="reference">Referenced by <a class="el" href="driver_8f90_source.html#l00012">driver()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d8b772108138bf796aaa3f7fe4e09294.html">sorc</a></li><li class="navelem"><a class="el" href="dir_d1522adfe0d0f9b268f9f6ec9cea4139.html">vcoord_gen.fd</a></li><li class="navelem"><a class="el" href="vcoord__gen_8f90.html">vcoord_gen.f90</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
